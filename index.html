<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Önskelista</title>
    <link rel="stylesheet" href="style.css" />
</head>

<body>
   <div class="background-container">
    <img src="background.webp" class="background-image" alt="Interactive Background" />
    <svg class="svg-overlay" viewBox="0 0 2560 1080" preserveAspectRatio="xMidYMid slice"
        style="position: absolute; top: 0; left: 0; width: 100%; height: 100%" xmlns="http://www.w3.org/2000/svg">

        <a href="#hotell" class="dot" data-id="hotell">
            <image href="gift.webp" x="510" y="570" width="60" height="60"></image>
        </a>

        <a href="#kilimanjaro" class="dot" data-id="kilimanjaro">
            <image href="gift.webp" x="870" y="290" width="60" height="60"></image>
        </a>

        <a href="#flygplan" class="dot" data-id="flygplan">
            <image href="gift.webp" x="1870" y="120" width="60" height="60"></image>
        </a>

        <a href="#giraff" class="dot" data-id="giraff">
            <image href="gift.webp" x="1220" y="450" width="60" height="60"></image>
        </a>

        <a href="#elefant" class="dot" data-id="elefant">
            <image href="gift.webp" x="1220" y="770" width="60" height="60"></image>
        </a>

        <a href="#hydda" class="dot" data-id="hydda">
            <image href="gift.webp" x="1860" y="780" width="60" height="60"></image>
        </a>

        <a href="#voluntar" class="dot" data-id="voluntar">
            <image href="gift.webp" x="940" y="910" width="60" height="60"></image>
        </a>

    </svg>
</div>

    <section id="hero" class="hero">
        <h1>Önskelista</h1>
        <p>
            För den som vill ge en present så är jag tacksam för bidrag till
            sommarens upplevelse. Jag har länge haft som högsta önskan att åka till
            Rift Valley i Kenya och Tanzania och nu ska det bli av! På vägen hem
            stannar vi till i Ghana. Om du vill ge någon present så får du gärna
            bidra till denna, som jag hoppas, fantastiska upplevelse. Se olika
            önskningar genom att klicka på paketen i Rebeccas fina teckning. Det
            går väldigt bra att skriva in er grattishälsning här i stället för i
            separat födelsedagskort :-)
        </p>

        <p class="warning">
            <!-- TODO: fixa text! -->
            VARNING: Bilden är för liten! Vänligen förstora/välj liggande läge på mobilen annars syns inte alla
            önskningar.
        </p>

        <button id="launch">Se önskningar</button>

    </section>

    <!-- Modal Dialog -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>

            <div>
                <table class="modal-table">
                    <thead>
                        <tr>
                            <th>Önskning</th>
                            <th>Pris</th>
                        </tr>
                    </thead>
                    <tr>
                        <td>titel</td>
                        <td>0000 kr</td>
                    </tr>
                </table>
                <form id="modal-form" method="post">
                    <label for="sender">Avsändare:</label>
                    <input type="text" id="sender" name="sender"></input>
                    <label for="message">Meddelande:</label>
                    <textarea id="message" name="message"></textarea>
                    <button type="submit">Skicka</button>
                </form>
            </div>

            <div class="modal-feed">
            </div>
        </div>

        <!-- <section>
        <h2>Instruktioner</h2>
        <p>
            Ge present genom att skriva in ert namn/hälsning på något ni vill ge hela eller delar av. (Detta kommer
            att bli synligt för andra.) Vid tekniska problem kontakta min IT-expert Daniel på 0722-338392 eller prata
            med honom på festen.
        </p>
    </section> -->
</body>

<script>
    const btn = document.querySelector("#launch");
    const hero = document.querySelector("#hero");
    btn.addEventListener("click", () => {
        hero.classList.toggle("hidden");
    });
</script>

<script type="module">
    const BACKEND_URL = "http://162.19.248.191:8000/";
    const GIFTS = {
        kilimanjaro: [
            {
                title: "Besök Kilimanjaro",
                amount: "1000 kr",
            },
        ],
        giraff: [
            {
                title: "Cykeltur och vandring Hell's gate nationalpark",
                amount: "400 kr",
            },
        ],
        hotell: [
            {
                title: "Hotellnätter",
                amount: "10 hotellnätter à 500 kr",
            },
        ],
        elefant: [
            {
                title: "Safari i Serengeti",
                amount: "4500 kr",
            },
            {
                title
                    : "Safari i Ngorongoro-kratern",
                amount: "2000 kr",
            },
        ],
        flygplan: [
            {
                title: "Flyg till Kenya",
                amount: "7000 kr",
            },
            {
                title: "Buss ToR Kenya-Tanzania",
                amount: "700 kr",
            },
            {
                title: "Flyg till Ghana",
                amount: "4500 kr",
            },
            {
                title: "Flyg till Köpenhamn",
                amount: "7000 kr",
            },
        ],
        hydda: [
            {
                title: "Ryggsäck",
                amount: "800 kr eller ungefär som denna",
            },
            {
                title: "Myggnät",
                amount: "700 kr eller ungefär som detta",
            },
            {
                title: "Vaccination",
                amount: "1500 kr",
            },
        ],
        voluntar: [
            {
                title: "Voluntärarbete",
                amount: "5000 kr",
            },
            {
                title: "Skolmaterial till barnen",
                amount: "Böcker på engelska, pennor, anteckningsbok mm"
            },
            {
                title: "Vaccination",
                amount: "1500 kr",
            },
        ],
    };

    // Get the modal and form elements
    const modal = document.getElementById("modal");
    const modalForm = document.getElementById("modal-form");
    const modalTitle = document.getElementById("modal-title");
    const modalAmount = document.getElementById("modal-amount");
    const modalTable = document.querySelector(".modal-table");
    const modalFeed = document.querySelector(".modal-feed");

    const senderInput = document.getElementById("sender");
    const messageInput = document.getElementById("message");

    // Get all pulsating dots
    const dots = document.querySelectorAll(".dot");

    /** @type {Array<{name: string, gift: string, message: string}>} */
    const data = await fetch(BACKEND_URL)
        .then((response) => response.json())
        .catch((error) => {
            console.error("Error:", error);
        });

    // Add click event listeners to dots
    dots.forEach((dot) => {
        dot.addEventListener("click", () => {
            // Get the data-id attribute of the clicked dot
            const giftId = dot.getAttribute("data-id");
            console.log(`Dot ${giftId} clicked!`);

            // title and amount for each gift instead
            const gift = GIFTS[giftId];
            modalTable.innerHTML = `
                <thead>
                    <tr>
                        <th>Önskning</th>
                        <th>Pris</th>
                    </tr>
                </thead>
                ${gift.map((g) => `
                    <tr>
                        <td>${g.title}</td>
                        <td>${g.amount} </td>
                    </tr>
                `).join("")}
            `;

            const messages = data?.filter((d) => d.gift === giftId) ?? [];
            if (messages.length > 0) {
                modalFeed.innerHTML = `
                    <h2>Meddelanden</h2>
                    <ul>
                        ${messages
                        .map((d) => `
                            <li>
                                <p>${d.name}</p>
                                <p><i>${d.message}</i></p>
                            </li>
                        `).join("")}
                    </ul>
                `;
            } else {
                modalFeed.innerHTML = "";
            }

            // Show the modal
            modal.style.display = "block";

            // Handle form submission
            modalForm.onsubmit = (e) => {
                e.preventDefault(); // Prevent form from submitting
                const sender = senderInput.value;
                const message = messageInput.value;

                fetch(BACKEND_URL, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        name: sender,
                        gift: giftId,
                        greeting: message,
                    }),
                })
                    .then((response) => response.json())
                    .then((data) => {
                        console.log("Success:", data);
                    })
                    .catch((error) => {
                        console.error("Error:", error);
                    });

                // Close the modal and reset the form
                modal.style.display = "none";
                modalForm.reset();
            };
        });
    });

    // Close the modal when the close button is clicked
    document.querySelector(".close").addEventListener("click", () => {
        modal.style.display = "none";
        modalForm.reset();
    });

    // Close the modal when clicking outside of it
    window.addEventListener("click", (event) => {
        if (event.target === modal) {
            modal.style.display = "none";
            modalForm.reset();
        }
    });
</script>

</html>
